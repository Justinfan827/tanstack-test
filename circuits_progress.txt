# Circuits Feature Progress

## Phase 1: Data Model & Backend - COMPLETE

### Completed Tasks

1. [x] Rename `header` -> `circuitHeader` in schema
   - Updated convex/schema.ts
   - Updated convex/helpers/validators.ts (headerRowInput -> circuitHeaderRowInput, headerFieldUpdates -> circuitHeaderFieldUpdates)
   - Updated all references in convex/programRows.ts, convex/programs.ts, convex/days.ts, convex/tools.ts

2. [x] Add `addCircuit` mutation
   - Renamed `addHeader` -> `addCircuit` in convex/programRows.ts
   - Renamed `internalAddHeader` -> `internalAddCircuit` in convex/programRows.ts
   - Updated tool references in convex/tools.ts

3. [x] Add `addExerciseToCircuit` mutation (via optional afterOrder)
   - Added `afterOrder` optional parameter to `addExercise` mutation
   - Added `afterOrder` optional parameter to `internalAddExercise` mutation
   - Added `insertRowAfter` helper in convex/helpers/ordering.ts for position-based insertion

4. [x] Update `deleteRow` to cascade for circuitHeaders
   - Updated `deleteRow` in convex/programRows.ts to detect circuitHeader and cascade delete grouped exercises
   - Updated `internalDeleteRow` with same cascade logic
   - Note: `deleteCircuit` mutation still exists as explicit cascade delete (renamed from deleteGroup)

### Migration
- Skipped per user request (no existing header rows to migrate)

### Files Modified
- convex/schema.ts
- convex/helpers/validators.ts
- convex/helpers/ordering.ts
- convex/programRows.ts
- convex/programs.ts
- convex/days.ts
- convex/tools.ts

---

## Phase 2: Grid Row Rendering - NOT STARTED

- [ ] Include `circuitHeader` rows in grid data
- [ ] Polymorphic row renderer (switch on `kind`)
- [ ] `CircuitHeaderRow` component
- [ ] Visual styling for grouped exercises

## Phase 3: Cell Polymorphism & Editability - NOT STARTED

- [ ] Conditional cell renderer for exercise name column
- [ ] Header: `short-text-cell`
- [ ] Exercise: `combobox-cell`
- [ ] Circuit header: disable editing on weight/reps/effort columns
- [ ] Circuit exercise: disable editing on sets column
- [ ] `updateCircuitSets` mutation with propagation
- [ ] Wire sets cell on header to propagation mutation

## Phase 4: Add Row UX - NOT STARTED

- [ ] Add row dropdown (Exercise | Circuit)
- [ ] Shift+Enter context detection
- [ ] Dropdown on last circuit exercise
- [ ] Wire mutations

## Phase 5: Delete Operations - NOT STARTED

- [ ] CMD+Backspace on header -> cascade delete
- [ ] CMD+Backspace on circuit exercise -> delete row

## Phase 6: Agent Integration - NOT STARTED

- [ ] `createCircuit` tool
- [ ] `addExerciseToCircuit` tool
- [ ] Update existing tools for circuit awareness
